(function() {
    'use strict';

    // Create a new "Click Me" button element
    var button = document.createElement('button');
    button.innerHTML = 'Click Me';

    // Style the button to position it in the upper right corner
    button.style.position = 'fixed';
    button.style.top = '10px';
    button.style.right = '10px';
    button.style.zIndex = 1000; // Ensure it appears over other elements

    // Add click event listener that triggers the extractTranscriptions function
    button.onclick = function() {
        extractTranscriptions();
    };

    // Append the button to the body
    document.body.appendChild(button);

    function extractTranscriptions() {
        // Locate the specific table
        var table = document.getElementById('ext-element-1275');
        var dialogues = [];

        if (table) {
            var rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                var speakerType = row.querySelector('td:nth-child(2) div');
                var textDivs = row.querySelectorAll('td:nth-child(3) div.transcript');

                var sentence = Array.from(textDivs).map(div => div.textContent.trim()).join(' ');

                if (speakerType.classList.contains('transcriptionSpeakerAgent')) {
                    dialogues.push('CCR: ' + sentence);
                } else if (speakerType.classList.contains('transcriptionSpeakerCustomer')) {
                    dialogues.push('Cx: ' + sentence);
                }
            });

            showResult(dialogues);
        } else {
            console.error('Table with id "ext-element-1275" not found.');
        }
    }

    function showResult(dialogues) {
        const newTab = window.open('', '_blank');
        if (newTab) {
            newTab.document.write(`
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <title>Transcriptions</title>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            background-color: white;
                            margin: 0;
                            padding: 20px;
                        }
                    </style>
                </head>
                <body>
                    <h1>Transcript of Conversation</h1>
                    <pre>${dialogues.join('\n')}</pre>
                </body>
                </html>
            `);
            newTab.document.close();
        } else {
            alert('Unable to open new tab. Please check your pop-up blocker settings.');
        }
    }
})();
